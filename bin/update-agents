#!/usr/bin/env bash
set -euo pipefail

log()  { echo "[update-agents] $(date '+%Y-%m-%d %H:%M:%S') $*"; }
warn() { echo "[update-agents] $(date '+%Y-%m-%d %H:%M:%S') WARN: $*"; }

log "Starting update..."

log "Upgrading brew packages (gemini-cli, claude-code)..."
brew upgrade gemini-cli claude-code 2>&1 || warn "brew upgrade failed"

log "Updating pi coding agent..."
npm install -g @mariozechner/pi-coding-agent 2>&1 || warn "npm install pi failed"

log "Running pi update..."
pi update 2>&1 || warn "pi update failed"

log "Updating skills..."
npx --yes skills update -g -y 2>&1 || warn "skills update failed"

log "Done."
